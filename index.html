<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Checklist</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Tiny Wins Daily">
    <meta property="og:description" content="Small steps. Big impact. Your daily checklist for building better habits.">
    <meta property="og:image" content="https://aprkim.github.io/daily-checklist/og-image.png">
    <meta property="og:url" content="https://aprkim.github.io/daily-checklist/">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tiny Wins Daily">
    <meta name="twitter:description" content="Small steps. Big impact. Your daily checklist for building better habits.">
    <meta name="twitter:image" content="https://aprkim.github.io/daily-checklist/og-image.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .modal-title-icon {
            width: 24px;
            height: 24px;
        }

        .modal-tagline {
            font-size: 18px;
            font-weight: 500;
            color: #BF3143;
            margin-bottom: 10px;
            text-align: center;
        }

        .modal-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }

        .template-option {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-option:hover:not(.selected) {
            border-color: #c0c0c0;
            background: #f5f5f5;
        }

        .template-option.selected {
            border-color: #BF3143;
            background: #fff5f7;
        }

        .template-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .template-description {
            font-size: 14px;
            color: #666;
        }

        .modal-button {
            width: 100%;
            padding: 15px;
            background: #BF3143;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .modal-button:hover {
            background: #a02838;
        }

        .modal-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .confirm-modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .confirm-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .confirm-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
        }

        .confirm-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirm-button.cancel {
            background: #e0e0e0;
            color: #333;
        }

        .confirm-button.cancel:hover {
            background: #d0d0d0;
        }

        .confirm-button.confirm {
            background: #BF3143;
            color: white;
        }

        .confirm-button.confirm:hover {
            background: #a02838;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: #ffffff;
            color: #333333;
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .main-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }

        .date {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #666;
        }

        .edit-mode-toggle {
            width: 100%;
            padding: 12px;
            background: white;
            border: 2px solid #e0e0e0;
            color: #666;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s, border-color 0.3s, color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 10px;
        }

        .edit-mode-toggle:hover {
            background: #f9f9f9;
            border-color: #BF3143;
            color: #BF3143;
        }

        .edit-mode-toggle.active {
            background: #333;
            color: white;
            border-color: #333;
        }

        .edit-mode-toggle:disabled {
            background: #e8e8e8;
            color: #999;
            border-color: #d0d0d0;
            cursor: not-allowed;
            opacity: 0.75;
        }

        .edit-mode-toggle:disabled:hover {
            background: #e8e8e8;
        }

        .progress-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .progress-label {
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e8e8e8;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: #BF3143;
            border-radius: 15px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-percentage {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .content {
            padding: 20px;
        }

        .task-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-list-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-icon {
            width: 20px;
            height: 20px;
            stroke: #666;
            stroke-width: 2;
            fill: none;
        }

        .clear-tasks-button {
            padding: 6px 16px;
            background: none;
            color: #666;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-tasks-button:hover {
            background: rgba(191, 49, 67, 0.1);
            color: #BF3143;
        }

        .task-list {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        #taskInput {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        #taskInput:focus {
            outline: none;
            border-color: #BF3143;
        }

        #addButton {
            padding: 12px 25px;
            background: #e8e8e8;
            color: #888;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: not-allowed;
            transition: transform 0.2s, opacity 0.3s, background 0.3s, color 0.3s;
        }

        #addButton:not(:disabled) {
            background: #BF3143;
            color: white;
            cursor: pointer;
        }

        #addButton:hover:not(:disabled) {
            transform: translateY(-2px);
            background: #a02838;
        }

        #addButton:active:not(:disabled) {
            transform: translateY(0);
        }

        #addButton:disabled {
            background: #e8e8e8;
            color: #999;
            cursor: not-allowed;
        }

        .task-list {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .change-template-button {
            width: 100%;
            padding: 12px;
            background: white;
            border: 2px solid #d0d0d0;
            color: #888;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s, border-color 0.3s, color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 20px;
        }

        .change-template-button:hover {
            background: #f9f9f9;
            border-color: #BF3143;
            color: #BF3143;
        }

        .footer {
            text-align: center;
            padding: 5px 0 0 0;
            color: #888;
            font-size: 14px;
        }

        .footer a {
            color: #888;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: #BF3143;
            text-decoration: underline;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            margin-bottom: 10px;
            background: white;
            transition: all 0.3s ease;
        }

        .task-item.dragging {
            opacity: 0.5;
            background: #f9f9f9;
        }

        .task-item.drag-over {
            border-top: 3px solid #BF3143;
        }

        .task-item.completed {
            opacity: 0.5;
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
        }

        .task-item.removing {
            opacity: 0;
            transform: scale(0.95);
        }

        .drag-handle {
            cursor: move;
            margin-left: 10px;
            color: #999;
            font-size: 18px;
            flex-shrink: 0;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-right: 15px;
            flex-shrink: 0;
            accent-color: #BF3143;
        }

        .edit-mode .task-checkbox {
            pointer-events: none;
            opacity: 0.3;
        }

        .task-text {
            flex: 1;
            font-size: 16px;
            word-break: break-word;
        }

        .edit-mode .task-text {
            cursor: pointer;
        }

        .task-edit-input {
            flex: 1;
            font-size: 16px;
            padding: 5px;
            border: 2px solid #888;
            border-radius: 5px;
            outline: none;
        }

        .reset-button {
            width: 100%;
            padding: 12px;
            background: #BF3143;
            color: white;
            border: 2px solid #BF3143;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .button-icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        .reset-button:hover {
            background: #a02838;
            box-shadow: 0 4px 8px rgba(191, 49, 67, 0.2);
        }

        /* Dim Reset Today button when user is typing or in edit mode */
        #taskInput:focus ~ .reset-button,
        body:has(#taskInput:focus) .reset-button,
        body:has(.edit-mode) .reset-button {
            opacity: 0.3;
            pointer-events: none;
        }

        .history-section {
            border-top: 2px solid #f0f0f0;
            padding-top: 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-icon {
            width: 20px;
            height: 20px;
            stroke: #666;
            stroke-width: 2;
            fill: none;
        }

        .clear-history-button {
            padding: 6px 16px;
            background: none;
            color: #666;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-history-button:hover {
            background: rgba(191, 49, 67, 0.1);
            color: #BF3143;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px 15px;
            border-left: 4px solid #BF3143;
            background: #f9f9f9;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-content {
            flex: 1;
        }

        .history-delete {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 5px 10px;
            transition: color 0.2s;
        }

        .history-delete:hover {
            color: #BF3143;
        }

        .history-date {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .history-stats {
            color: #666;
            font-size: 14px;
        }

        .history-item.placeholder {
            opacity: 0.4;
            pointer-events: none;
        }

        .empty-message {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-style: italic;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            position: absolute;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Scrollbar styling */
        .task-list::-webkit-scrollbar,
        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .task-list::-webkit-scrollbar-track,
        .history-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .task-list::-webkit-scrollbar-thumb,
        .history-list::-webkit-scrollbar-thumb {
            background: #BF3143;
            border-radius: 10px;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .date {
                font-size: 20px;
            }

            .content {
                padding: 15px;
            }

            .input-section {
                flex-direction: column;
            }

            #addButton {
                width: 100%;
            }

            .modal {
                padding: 25px;
            }

            .template-option {
                padding: 15px;
                margin-bottom: 10px;
            }

            .modal-title-icon {
                width: 22px;
                height: 22px;
            }

            .modal-title {
                flex-direction: column;
                gap: 6px;
                font-size: 26px;
                font-weight: 630;
            }

            .modal-tagline {
                font-size: 16px;
            }

            .modal-subtitle {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="modal-overlay" id="setupModal">
        <div class="modal">
            <div class="modal-title">
                <svg class="modal-title-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 3v18l7-5 7 5V3H5z" fill="#BF3143"/>
                </svg>
                Welcome to Tiny Wins!
            </div>
            <div class="modal-tagline">Small steps. Big impact.</div>
            <div class="modal-subtitle">Choose a template to get started, or begin with an empty list.</div>
            
            <div class="template-option" onclick="selectTemplate('empty')">
                <div class="template-name">Empty List</div>
                <div class="template-description">Start fresh and add your own tasks</div>
            </div>
            
            <div class="template-option" onclick="selectTemplate('productivity')">
                <div class="template-name">Daily Productivity</div>
                <div class="template-description">Morning routine, focus time, exercise, and self-care essentials</div>
            </div>
            
            <div class="template-option" onclick="selectTemplate('wellness')">
                <div class="template-name">Health & Wellness</div>
                <div class="template-description">Fitness, nutrition, mindfulness, and healthy habits</div>
            </div>
            
            <div class="template-option" onclick="selectTemplate('student')">
                <div class="template-name">Student Life</div>
                <div class="template-description">Study sessions, assignments, classes, and balance</div>
            </div>
            
            <div class="template-option" onclick="selectTemplate('remote')">
                <div class="template-name">Remote Worker</div>
                <div class="template-description">Work-from-home routine, meetings, breaks, and boundaries</div>
            </div>
            
            <button class="modal-button" id="confirmTemplate" onclick="confirmTemplateSelection()" disabled>Continue</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="main-title">Tiny Wins Daily</div>
            <div class="date" id="currentDate"></div>
            <div class="progress-section">
                <div class="progress-label" id="progressLabel">Progress: 0 / 0 tasks completed</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="task-list-header">
                <div class="task-list-title">
                    <svg class="task-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                    Tasks
                </div>
                <button class="clear-tasks-button" onclick="clearAllTasks()">Clear All</button>
            </div>
            <div class="task-list" id="taskList"></div>

            <div class="input-section">
                <input 
                    type="text" 
                    id="taskInput" 
                    placeholder="Enter a new task..." 
                    maxlength="200"
                >
                <button id="addButton">Add</button>
            </div>

            <button class="reset-button" id="resetButton">
                <svg class="button-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                <span>Reset Today</span>
            </button>

            <button class="edit-mode-toggle" id="editModeToggle" onclick="toggleEditMode()">
                <svg class="button-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                <span>Edit Mode</span>
            </button>

            <div class="history-section">
                <div class="history-header">
                    <div class="history-title">
                        <svg class="history-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        History
                    </div>
                    <button class="clear-history-button" onclick="clearAllHistory()">Clear All</button>
                </div>
                <div class="history-list" id="historyList"></div>
            </div>

            <button class="change-template-button" onclick="changeTemplate()">
                <svg class="button-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 5a1 1 0 011-1h4a1 1 0 011 1v7H4V5zm0 9h6v5a1 1 0 01-1 1H5a1 1 0 01-1-1v-5zM14 5a1 1 0 011-1h4a1 1 0 011 1v5h-6V5zm0 7h6v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7z"/>
                </svg>
                <span>Change Template</span>
            </button>

            <div class="footer">
                Created by <a href="mailto:aprkim@gmail.com">April Kim</a> • 2025
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay hidden" id="confirmModal">
        <div class="confirm-modal">
            <div class="confirm-title" id="confirmTitle">Confirm Action</div>
            <div class="confirm-message" id="confirmMessage">Are you sure?</div>
            <div class="confirm-buttons">
                <button class="confirm-button cancel" onclick="closeConfirmModal()">Cancel</button>
                <button class="confirm-button confirm" id="confirmButton">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Data structure
        let currentData = {
            date: '',
            tasks: [],
            totalTasks: 0,
            completedTasks: 0,
            confettiShown: false
        };

        let history = [];
        let selectedTemplateType = null;
        let activeDate = null; // The date shown in the header

        // Template definitions
        const templates = {
            empty: [],
            productivity: [
                "Did you make your bed?",
                "Did you complete your morning routine?",
                "Did you plan your top 3 priorities?",
                "Did you do a focused work session?",
                "Did you exercise or move your body?"
            ],
            wellness: [
                "Did you drink enough water today?",
                "Did you eat nutritious meals?",
                "Did you exercise for at least 30 minutes?",
                "Did you practice mindfulness or meditation?",
                "Did you get enough sleep last night?"
            ],
            student: [
                "Did you attend all your classes?",
                "Did you complete today's assignments?",
                "Did you review your notes?",
                "Did you study for upcoming exams?",
                "Did you take breaks and rest?"
            ],
            remote: [
                "Did you set up your workspace properly?",
                "Did you attend all scheduled meetings?",
                "Did you take regular breaks?",
                "Did you communicate with your team?",
                "Did you end work at a reasonable time?"
            ]
        };

        // Select template
        function selectTemplate(type) {
            selectedTemplateType = type;
            
            // Update UI
            document.querySelectorAll('.template-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.closest('.template-option').classList.add('selected');
            document.getElementById('confirmTemplate').disabled = false;
        }

        // Confirm template selection
        function confirmTemplateSelection() {
            if (!selectedTemplateType) return;
            
            // Mark that setup is complete
            localStorage.setItem('setupComplete', 'true');
            
            // Clear existing tasks and reset currentData
            currentData = {
                date: getTodayString(),
                tasks: [],
                totalTasks: 0,
                completedTasks: 0,
                confettiShown: false
            };
            
            // Set activeDate to today
            activeDate = getTodayString();
            localStorage.setItem('activeDate', activeDate);
            
            // Initialize with selected template
            const templateTasks = templates[selectedTemplateType];
            templateTasks.forEach((taskText, index) => {
                currentData.tasks.push({
                    id: Date.now() + index,
                    text: taskText,
                    completed: false
                });
            });
            currentData.totalTasks = templateTasks.length;
            
            // Save template tasks as user's default tasks
            localStorage.setItem('userDefaultTasks', JSON.stringify(templateTasks));
            
            saveData();
            
            // Hide modal
            document.getElementById('setupModal').classList.add('hidden');
            
            // Initialize app
            updateDateDisplay();
            updateProgress();
            renderTasks();
            renderHistory();
            setupEventListeners();
        }

        // Check if setup is needed
        function checkFirstTimeSetup() {
            const setupComplete = localStorage.getItem('setupComplete');
            const hasData = localStorage.getItem('dailyChecklistData');
            
            if (!setupComplete && !hasData) {
                // Show setup modal
                document.getElementById('setupModal').classList.remove('hidden');
                return true;
            }
            
            // Hide modal
            document.getElementById('setupModal').classList.add('hidden');
            return false;
        }

        // Initialize app
        function init() {
            // Check if first-time setup is needed
            if (checkFirstTimeSetup()) {
                return; // Don't continue init until template is selected
            }
            
            // Initialize activeDate from localStorage or set to today
            const savedActiveDate = localStorage.getItem('activeDate');
            if (savedActiveDate) {
                activeDate = savedActiveDate;
            } else {
                activeDate = getTodayString();
                localStorage.setItem('activeDate', activeDate);
            }
            
            loadData();
            checkDateChange();
            initializeDefaultTasks();
            updateDateDisplay();
            updateProgress();
            renderTasks();
            renderHistory();
            setupEventListeners();
        }

        // Initialize default tasks if it's a new day with no tasks
        function initializeDefaultTasks() {
            // This function is now a no-op since we use the setup flow
            // Tasks are loaded from localStorage or setup modal
            return;
        }

        // Get today's date string
        function getTodayString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Format date for display
        function formatDate(dateString) {
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Update date display
        function updateDateDisplay() {
            document.getElementById('currentDate').textContent = formatDate(activeDate);
        }

        // Check if date has changed
        function checkDateChange() {
            const today = getTodayString();
            
            if (currentData.date && currentData.date !== today) {
                // Save yesterday's data to history
                if (currentData.totalTasks > 0) {
                    history.unshift({
                        date: currentData.date,
                        totalTasks: currentData.totalTasks,
                        completedTasks: currentData.completedTasks
                    });
                }
                
                // Start fresh for new day
                currentData = {
                    date: today,
                    tasks: [],
                    totalTasks: 0,
                    completedTasks: 0,
                    confettiShown: false
                };
                
                saveData();
            } else if (!currentData.date) {
                currentData.date = today;
            }
        }

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('dailyChecklistData');
            const savedHistory = localStorage.getItem('dailyChecklistHistory');
            
            if (saved) {
                currentData = JSON.parse(saved);
            }
            
            if (savedHistory) {
                history = JSON.parse(savedHistory);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('dailyChecklistData', JSON.stringify(currentData));
            localStorage.setItem('dailyChecklistHistory', JSON.stringify(history));
        }
        
        // Save user's default task list template (only uncompleted tasks become the daily template)
        function saveUserDefaultTasks() {
            // Save active (uncompleted) task texts - the master list for daily resets
            const activeTaskTexts = currentData.tasks
                .filter(t => !t.completed)
                .map(t => t.text);
            localStorage.setItem('userDefaultTasks', JSON.stringify(activeTaskTexts));
        }

        // Add new task
        function addTask() {
            const input = document.getElementById('taskInput');
            const taskText = input.value.trim();
            
            if (!taskText) return;
            
            const task = {
                id: Date.now(),
                text: taskText,
                completed: false
            };
            
            currentData.tasks.push(task);
            currentData.totalTasks++;
            
            input.value = '';
            updateAddButtonState();
            
            saveData();
            saveUserDefaultTasks();
            updateProgress();
            renderTasks();
            
            // Scroll the task list to the bottom to show newly added task
            setTimeout(() => {
                const taskList = document.getElementById('taskList');
                taskList.scrollTop = taskList.scrollHeight;
            }, 50);
        }

        // Complete task
        function completeTask(taskId) {
            const task = currentData.tasks.find(t => t.id === taskId);
            if (!task || task.completed) return;
            
            task.completed = true;
            currentData.completedTasks++;
            
            // Add strikethrough style
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                taskElement.classList.add('completed');
                
                // Remove after 1.5 seconds
                setTimeout(() => {
                    taskElement.classList.add('removing');
                    setTimeout(() => {
                        renderTasks();
                    }, 300);
                }, 1500);
            }
            
            saveData();
            updateProgress();
            checkForConfetti();
        }

        // Update progress display
        function updateProgress() {
            const { totalTasks, completedTasks } = currentData;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('progressLabel').textContent = 
                `Progress: ${completedTasks} / ${totalTasks} tasks completed (${percentage}% Completed)`;
            
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
        }

        // Render tasks
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            const editModeToggle = document.getElementById('editModeToggle');
            const clearTasksButton = document.querySelector('.clear-tasks-button');
            const activeTasks = currentData.tasks.filter(t => !t.completed);
            
            if (activeTasks.length === 0) {
                taskList.innerHTML = '<div class="empty-message">No tasks yet. Add one below!</div>';
                editModeToggle.disabled = true;
                clearTasksButton.style.display = 'none';
                // Turn off edit mode if it's on
                if (editModeEnabled) {
                    toggleEditMode();
                }
                return;
            }
            
            // Enable edit mode button and show clear button when there are tasks
            editModeToggle.disabled = false;
            clearTasksButton.style.display = 'block';
            
            taskList.innerHTML = activeTasks.map(task => `
                <div class="task-item" data-task-id="${task.id}" draggable="true">
                    <input 
                        type="checkbox" 
                        class="task-checkbox" 
                        id="checkbox-${task.id}"
                        onchange="completeTask(${task.id})"
                    >
                    <span class="task-text" onclick="handleTaskTextClick(${task.id})">${escapeHtml(task.text)}</span>
                    <span class="drag-handle">&#8942;&#8942;</span>
                </div>
            `).join('');
            
            setupDragAndDrop();
        }

        // Render history
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            const clearHistoryButton = document.querySelector('.clear-history-button');
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="empty-message">No history yet.</div>';
                clearHistoryButton.style.display = 'none';
                return;
            }
            
            // Show clear button when there is history
            clearHistoryButton.style.display = 'block';
            
            historyList.innerHTML = history.map((entry, index) => {
                const percentage = Math.round((entry.completedTasks / entry.totalTasks) * 100);
                return `
                    <div class="history-item">
                        <div class="history-content">
                            <div class="history-date">${formatDate(entry.date)}</div>
                            <div class="history-stats">
                                ${entry.completedTasks} / ${entry.totalTasks} tasks completed (${percentage}%)
                            </div>
                        </div>
                        <button class="history-delete" onclick="deleteHistoryItem(${index})" title="Delete">×</button>
                    </div>
                `;
            }).join('');
        }

        // Check if confetti should be shown
        function checkForConfetti() {
            const { totalTasks, completedTasks, confettiShown } = currentData;
            
            if (totalTasks > 0 && completedTasks === totalTasks && !confettiShown) {
                showConfetti();
                currentData.confettiShown = true;
                saveData();
            }
        }

        // Show confetti animation
        function showConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff1493'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.opacity = '1';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    confetti.style.animation = `confetti-fall ${2 + Math.random()}s linear forwards`;
                    confetti.style.zIndex = '9999';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 30);
            }
        }

        // Reset today's tasks
        function resetToday() {
            showConfirmModal(
                'Reset Today',
                'Are you sure you want to reset today\'s tasks? This cannot be undone.',
                () => {
                    currentData.tasks = [];
                    currentData.totalTasks = 0;
                    currentData.completedTasks = 0;
                    currentData.confettiShown = false;
                    
                    // Update activeDate to current date
                    activeDate = getTodayString();
                    localStorage.setItem('activeDate', activeDate);
                    
                    // Turn off edit mode if it's on
                    if (editModeEnabled) {
                        toggleEditMode();
                    }
                    
                    // Reload user's saved default tasks
                    const savedDefaultTasks = localStorage.getItem('userDefaultTasks');
                    if (savedDefaultTasks) {
                        const taskTexts = JSON.parse(savedDefaultTasks);
                        taskTexts.forEach((taskText, index) => {
                            currentData.tasks.push({
                                id: Date.now() + index,
                                text: taskText,
                                completed: false
                            });
                        });
                        currentData.totalTasks = taskTexts.length;
                    }
                    
                    saveData();
                    updateProgress();
                    updateDateDisplay();
                    renderTasks();
                }
            );
        }

        // Clear all tasks permanently
        function clearAllTasks() {
            showConfirmModal(
                'Clear All Tasks',
                'Are you sure you want to permanently delete all tasks? This cannot be undone and will remove them from your daily checklist.',
                () => {
                    currentData.tasks = [];
                    currentData.totalTasks = 0;
                    currentData.completedTasks = 0;
                    currentData.confettiShown = false;
                    
                    // Turn off edit mode if it's on
                    if (editModeEnabled) {
                        toggleEditMode();
                    }
                    
                    // Clear the saved default tasks
                    localStorage.setItem('userDefaultTasks', JSON.stringify([]));
                    
                    saveData();
                    updateProgress();
                    renderTasks();
                }
            );
        }

        // Change template - return to template selection
        function changeTemplate() {
            showConfirmModal(
                'Change Template',
                'Are you sure you want to change your template? This will clear all current tasks and history.',
                () => {
                    // Clear all data
                    currentData = {
                        date: '',
                        tasks: [],
                        totalTasks: 0,
                        completedTasks: 0,
                        confettiShown: false
                    };
                    history = [];
                    activeDate = null;
                    selectedTemplateType = null;
                    
                    // Clear localStorage
                    localStorage.removeItem('dailyChecklistData');
                    localStorage.removeItem('dailyChecklistHistory');
                    localStorage.removeItem('userDefaultTasks');
                    localStorage.removeItem('activeDate');
                    localStorage.removeItem('setupComplete');
                    
                    // Turn off edit mode if it's on
                    if (editModeEnabled) {
                        toggleEditMode();
                    }
                    
                    // Show template selection modal
                    document.getElementById('setupModal').classList.remove('hidden');
                }
            );
        }

        // Delete history item
        function deleteHistoryItem(index) {
            history.splice(index, 1);
            localStorage.setItem('dailyChecklistHistory', JSON.stringify(history));
            renderHistory();
        }

        // Clear all history
        function clearAllHistory() {
            showConfirmModal(
                'Clear All History',
                'Are you sure you want to delete all history? This cannot be undone.',
                () => {
                    history = [];
                    localStorage.setItem('dailyChecklistHistory', JSON.stringify(history));
                    renderHistory();
                }
            );
        }

        // Update add button state
        function updateAddButtonState() {
            const input = document.getElementById('taskInput');
            const button = document.getElementById('addButton');
            button.disabled = !input.value.trim();
        }

        // Handle task text click based on mode
        function handleTaskTextClick(taskId) {
            if (editModeEnabled) {
                startEditTask(taskId);
            } else {
                document.getElementById(`checkbox-${taskId}`).click();
            }
        }

        // Start editing a task
        function startEditTask(taskId) {
            const task = currentData.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            const taskTextElement = taskElement.querySelector('.task-text');
            const dragHandle = taskElement.querySelector('.drag-handle');
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'task-edit-input';
            input.value = task.text;
            
            // Replace text with input
            taskTextElement.replaceWith(input);
            input.focus();
            input.select();
            
            // Hide drag handle during edit
            dragHandle.style.display = 'none';
            taskElement.draggable = false;
            
            // Save on Enter or blur
            const saveEdit = () => {
                const newText = input.value.trim();
                if (newText === '') {
                    // Delete task if text is empty
                    currentData.tasks = currentData.tasks.filter(t => t.id !== taskId);
                    if (!task.completed) {
                        currentData.totalTasks--;
                    }
                    saveData();
                    saveUserDefaultTasks();
                    updateProgress();
                } else if (newText !== task.text) {
                    task.text = newText;
                    saveData();
                    saveUserDefaultTasks();
                }
                input.blur(); // Remove focus
                renderTasks();
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                }
            });
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    input.blur(); // Remove focus
                    renderTasks();
                }
            });
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            const taskItems = document.querySelectorAll('.task-item');
            
            taskItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragleave', handleDragLeave);
            });
            
            // Apply edit mode state if active
            if (editModeEnabled) {
                document.getElementById('taskList').classList.add('edit-mode');
                document.getElementById('editModeToggle').classList.add('active');
                document.getElementById('editModeToggle').textContent = '✓ Done Editing';
            }
        }

        let draggedElement = null;
        let editModeEnabled = false;

        // Custom confirmation modal
        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.remove('hidden');
            
            // Remove old event listener and add new one
            const confirmBtn = document.getElementById('confirmButton');
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            // Store callback in closure, not global variable
            newConfirmBtn.onclick = () => {
                closeConfirmModal();
                if (onConfirm) {
                    onConfirm();
                }
            };
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
        }

        function toggleEditMode() {
            editModeEnabled = !editModeEnabled;
            const taskList = document.getElementById('taskList');
            const toggleButton = document.getElementById('editModeToggle');
            
            const editIcon = `
                <svg class="button-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
            `;
            
            if (editModeEnabled) {
                taskList.classList.add('edit-mode');
                toggleButton.classList.add('active');
                toggleButton.innerHTML = editIcon + '<span>Done Editing</span>';
            } else {
                taskList.classList.remove('edit-mode');
                toggleButton.classList.remove('active');
                toggleButton.innerHTML = editIcon + '<span>Edit Mode</span>';
            }
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.task-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
            return false;
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedElement !== this) {
                const draggedId = parseInt(draggedElement.getAttribute('data-task-id'));
                const targetId = parseInt(this.getAttribute('data-task-id'));
                
                const draggedIndex = currentData.tasks.findIndex(t => t.id === draggedId);
                const targetIndex = currentData.tasks.findIndex(t => t.id === targetId);
                
                if (draggedIndex !== -1 && targetIndex !== -1) {
                    const draggedTask = currentData.tasks.splice(draggedIndex, 1)[0];
                    currentData.tasks.splice(targetIndex, 0, draggedTask);
                    
                    saveData();
                    saveUserDefaultTasks();
                    renderTasks();
                }
            }
            
            this.classList.remove('drag-over');
            return false;
        }

        // Setup event listeners
        function setupEventListeners() {
            const input = document.getElementById('taskInput');
            const addButton = document.getElementById('addButton');
            const resetButton = document.getElementById('resetButton');
            
            addButton.addEventListener('click', addTask);
            resetButton.addEventListener('click', resetToday);
            
            input.addEventListener('input', updateAddButtonState);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTask();
                }
            });
            
            // Initial button state
            updateAddButtonState();
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Check for date change periodically
        setInterval(() => {
            checkDateChange();
            updateDateDisplay();
        }, 60000); // Check every minute

        // Initialize on load
        init();
    </script>
</body>
</html>
